#!/bin/bash
PWD=$(pwd)

HEADPREINST='if [ "$1" = "install" -o "$1" = "upgrade" ]; then'
FOOTPREINST='fi'


HEADPOSTRM='if [ "$1" = "purge" -o "$1" = "remove" -o "$1" = "upgrade" ]; then'
FOOTPOSTRM='fi'

echo $HEADPREINST >> ${PWD}/debian/lliurex-langpack-kde.preinst.debhelper
echo $HEADPOSTRM >> ${PWD}/debian/lliurex-langpack-kde.postrm.debhelper


MOPATH="/usr/share/locale/ca@valencia/LC_MESSAGES/"
INSTALLMOPATH="debian/lliurex-langpack-kde$MOPATH"
mkdir -p $INSTALLMOPATH

for POFILE in $(find . -type f -name *.po -not -path debian); do
	APPNAME=$(basename $POFILE .po)
	msgfmt $POFILE -o ${INSTALLMOPATH}$APPNAME.mo
	echo "dpkg-divert --package lliurex-langpack-kde --quiet --add --rename ${MOPATH}${APPNAME}.mo" >> ${PWD}/debian/lliurex-langpack-kde.preinst.debhelper
	echo "dpkg-divert --package lliurex-langpack-kde --quiet --remove ${MOPATH}${APPNAME}.mo" >> ${PWD}/debian/lliurex-langpack-kde.postrm.debhelper

done

for TSFILE in $(find . -type f -name *.ts -not -path debian); do
	APPNAME=$(basename $TSFILE .ts)
	lrelease $POFILE -qm ${INSTALLMOPATH}$APPNAME.qm
	echo "dpkg-divert --package lliurex-langpack-kde --quiet --add --rename ${MOPATH}${APPNAME}.qm" >> ${PWD}/debian/lliurex-langpack-kde.preinst.debhelper
	echo "dpkg-divert --package lliurex-langpack-kde --quiet --remove ${MOPATH}${APPNAME}.qm" >> ${PWD}/debian/lliurex-langpack-kde.postrm.debhelper

done


echo $FOOTPREINST >> ${PWD}/debian/lliurex-langpack-kde.preinst.debhelper
echo $FOOTPOSTRM >> ${PWD}/debian/lliurex-langpack-kde.postrm.debhelper
